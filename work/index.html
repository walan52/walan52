<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <title>å·¥ä½œæ¸…å–®ï¼ˆFirebaseï¼‰</title>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-database-compat.js"></script>
  <style>
    body {
      font-family: sans-serif;
      padding: 20px;
    }
    #taskList div {
      padding: 10px;
      margin: 5px 0;
      background-color: #f0f0f0;
      border-radius: 6px;
    }
    button {
      margin-left: 10px;
    }
  </style>
</head>
<body>
  <h2>æ–°å¢å·¥ä½œ</h2>
  <input type="text" id="taskInput" placeholder="è¼¸å…¥å·¥ä½œå…§å®¹">
  <button onclick="addTask()">æ–°å¢</button>

  <h3>å·¥ä½œæ¸…å–®</h3>
  <div id="taskList"></div>

  <script>
    // âœ… åˆå§‹åŒ– Firebase
    const firebaseConfig = {
      apiKey: "AIzaSyDEAwHvpNiiao5m3qTddWwiKs8N26jhKh8",
      authDomain: "score-app-78575.firebaseapp.com",
      databaseURL: "https://score-app-78575-default-rtdb.firebaseio.com",
      projectId: "score-app-78575",
      storageBucket: "score-app-78575.firebasestorage.app",
      messagingSenderId: "795421843509",
      appId: "1:795421843509:web:bff4bd34dfb0c1e0c7517c",
      measurementId: "G-VDF130B9TW"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    // ğŸ”„ è¼‰å…¥è³‡æ–™
    const taskList = document.getElementById("taskList");
    firebase.database().ref("tasks").on("value", snapshot => {
      taskList.innerHTML = "";
      snapshot.forEach(child => {
        const data = child.val();
        const key = child.key;
        createTaskElement(data.date, data.task, data.status, key);
      });
    });

    // â• æ–°å¢ä»»å‹™
    function addTask() {
      const taskInput = document.getElementById("taskInput");
      const taskText = taskInput.value.trim();
      if (taskText === "") return alert("è«‹è¼¸å…¥å·¥ä½œå…§å®¹");

      const date = new Date().toLocaleDateString();
      const newTaskRef = db.ref("tasks").push();
      newTaskRef.set({
        date: date,
        task: taskText,
        status: "å¾…è™•ç†"
      });

      taskInput.value = "";
    }

    // ğŸ§± å»ºç«‹ä»»å‹™å…ƒä»¶
    function createTaskElement(date, taskText, status, key) {
      const taskItem = document.createElement("div");

      const textSpan = document.createElement("span");
      textSpan.textContent = `${date} - ${taskText}`;
      taskItem.appendChild(textSpan);

      if (status === "å¾…è™•ç†") {
        const pendingBtn = document.createElement("button");
        pendingBtn.textContent = "å¾…è™•ç†";
        pendingBtn.onclick = function () {
          db.ref("tasks/" + key).update({
            status: "å·²å®Œæˆ"
          });
        };
        taskItem.appendChild(pendingBtn);
      } else if (status === "å·²å®Œæˆ") {
        const doneSpan = document.createElement("span");
        doneSpan.textContent = " âœ… è™•ç†å®Œç•¢";
        taskItem.appendChild(doneSpan);

        const deleteBtn = document.createElement("button");
        deleteBtn.textContent = "åˆªé™¤";
        deleteBtn.onclick = function () {
          db.ref("tasks/" + key).remove();
        };
        taskItem.appendChild(deleteBtn);
      }

      taskList.appendChild(taskItem);
    }
  </script>
</body>
</html>
